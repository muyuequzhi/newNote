<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../jquery-3.6.0.min.js"></script>
  <script src="../echarts.js"></script>
  <title>Document</title>
</head>
<body>
  <div id="chart" style="width: 100%;height: 500px;"> </div>
</body>

<script>
  // var names = '北方稀土，紫金矿业，中国核电，上海电力，新易盛，中芯国际，工业富联，寒武纪'.split('，')
  var names = '北方稀土 紫金矿业 新莱应材 立讯精密 西部超导 中科电气'.split(' ')
  var option = {
      title: {
        text: '单位：元',
        textStyle: {
          color: '#809FB8',
          fontSize: 14,
          fontWeight: 'normal'
        }
      },
      tooltip: {
        trigger: 'axis'
      },
      legend: {
        right: 10,
        textStyle: {
          color: '#809FB8'
        },
        
      },
      grid: {
        top: '12%',
        right: '3%',
        left: '10%',
        bottom: '8%',

      },
      dataZoom: [
          {
            type: 'inside',
            start: 0,
            end: 20
          },
          {
            start: 0,
            end: 20
          }
        ],
      xAxis: [
        {
          type: 'category',
          boundaryGap: false,
          axisTick: {
            show: false // 隐藏x轴刻度线
          },
          axisLine: {
            show: false // 隐藏x轴横线
          },
          axisLabel: {
            color: '#809FB8'
          },
          data: names
        }
      ],
      yAxis: [
        {
          type: 'value',
          axisLabel: {
            color: '#809FB8'
          }
        }
      ],
      series: [
        {
          name: '手机银行',
          type: 'line',
          symbol: 'none',
          itemStyle: {
            color: '#3977FC'
          },
          data: [120, 132, 101, 134, 90, 230]
        },
      ]
    };

  function initLineChart3() {
      var chartDom = document.getElementById('chart');
      var myChart = echarts.init(chartDom);
      option && myChart.setOption(option);
    }
 
  $.ajax({
    url: "http://127.0.0.1:5000/get_stock_data",
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify({
      stock_names: names,
      start_date: "20240101",
      end_date: "20251016"
    }),
    success: function(data) {
      var result = []
      var xVal = []
      console.log("返回数据：", data);
      option.legend.data = names;
       names.forEach((name) => {
        var arr = data[name]
        xVal = []
        var val1 = []
        var val2 = []
        if(!arr) {
          return
        }
        arr.forEach((item) => {
          xVal.push(item['日期'])
          val1.push(item['收盘'])
          val2.push(item['涨跌幅'])
        })
     
        var obj = {
          name: name,
          type: 'line',
          symbol: 'none',
         
          data: val1
        }
        result.push(obj)
       })
       option.xAxis[0].data = xVal
       option.series = result
       console.log(option)
       initLineChart3()
    },
    error: function(xhr, status, error) {
      console.error("请求失败：", error);
    }
  });
</script>
</html>